<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <title>연락처</title>
</head>
<body>
<h1>소환사 상세정보</h1>
<form>
  아이디* : <input id="x-userId" type="text"><br>
  티어* : <input id="x-tier" type="text"><br>
  주 포지션 : <input id="x-position" type="text"><br>
  주 챔피언 : <input id="x-champ" type="text"><br>
<button id="x-update-btn" type="button">변경</button>
<button id="x-delete-btn" type="button">삭제</button>
<button id="x-cancel-btn" type="button">취소</button>
</form>

<script type="text/javascript">

// 요청 유효성 검사
if (location.href.indexOf('?') == -1) {
  window.alert("요청이 올바르지 않습니다!");
  location.href = "index.html";
}

// URL에서 쿼리스트링을 추출하여 파라미터의 이름과 값을 분리한다.
var params = new URLSearchParams(location.href.split('?')[1]);

// 쿼리스트링에서 이메일 값을 추출한다.
var userId = params.get("userId");
if (userId == null) {
  window.alert("아이디가 없습니다.");
  location.href = "index.html";
}

var xUserId = document.querySelector("#x-userId");
var xTier = document.querySelector("#x-tier");
var xPosition = document.querySelector("#x-position");
var xChamp = document.querySelector("#x-champ");
// 이메일을 가지고 연락처 상세 정보를 가져와서 입력폼에 넣는다.
fetch(`/my1/get?userId=${userId}`)
.then(function(response) {
  return response.text();
})
.then(function(result) {
  if (result == "") {
    window.alert("해당 아이디를 찾을 수 없습니다!");
    location.href = "index.html";
  }
  // 4) 연락처 상세 정보를 화면에 출력한다
    var contact = result.split(",");
    xUserId.value = contact[0];
    xTier.value = contact[1];
    xPosition.value = contact[2];
    xChamp.value = contact[3];
  });

document.querySelector("#x-update-btn").onclick = function() {
  if (xUserId.value=="" || xTier.value == ""){
    window.alert("")
  }



  fetch(`/my1/add?userId=${xUserId.value}&tier=${xTier.value}&position=${xPosition.value}&champ=${xChamp.value}`)
    .then(function(response) {
      return response.text(); // 서버에서 보낸 데이터를 그냥 그대로 텍스트로 리턴해줘! JSON 문자열을 처리하지마!
    })
    .then(function(result) {
      console.log(result);
      location.href = "index.html";
    });

};

document.querySelector("#x-cancel-btn").onclick = function() {
  window.location.href = "index.html";
};

document.querySelector("#x-delete-btn").onclick=function(){
  fetch(`/my1/delete?userId=${userId}`)
  .then(function(response){
    return response.json();
  })
  .then(function(result){
    console.log(result);
    window.location.href = "index.html";
  });

};


</script>

</body>
</html>

















<!-- -->
